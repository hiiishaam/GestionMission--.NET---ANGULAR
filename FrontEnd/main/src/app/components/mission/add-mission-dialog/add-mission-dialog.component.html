<h2 mat-dialog-title style="text-align: center;">{{data.data.name}}</h2>

<mat-dialog-content>

  <!-- √âtape 1 : Informations g√©n√©rales -->
  <div *ngIf="currentStep === 1">
    <h3>Informations g√©n√©rales</h3>
    <br/>
    <br/>
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Raison de la mission</mat-label>
      <textarea matInput [(ngModel)]="data.data.description" [disabled]="isReadOnly" required #end="ngModel" placeholder="Entrez le motif de deplacement"></textarea>
      <mat-error *ngIf="end.invalid && end.touched">La raison est obligatoire.</mat-error>
    </mat-form-field>
    <br/>
    <br/>
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Employ√© concern√©</mat-label>
      <mat-select [(ngModel)]="data.data.employeId" [disabled]="isReadOnly" required #employe="ngModel">
        <mat-option *ngFor="let emp of employes" [value]="emp.id">
          {{emp.firstName + " " + emp.lastName }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="employe.invalid && employe.touched">Veuillez s√©lectionner un employ√©.</mat-error>
    </mat-form-field>
    <br/>
    <br/>
      <!-- Date de d√©part (requise) -->
   <mat-form-field appearance="outline" class="full-width">
      <mat-label>Date de d√©part</mat-label>
      <input matInput [(ngModel)]="data.data.dateDepart"
            [matDatepicker]="pickerDepart"
            [disabled]="isReadOnly"
            required
            #retour="ngModel"
            readonly />
      <mat-datepicker-toggle matIconSuffix [for]="pickerDepart"></mat-datepicker-toggle>
      <mat-datepicker #pickerDepart></mat-datepicker>
      <mat-error *ngIf="retour.invalid && retour.touched">La date de d√©part est requise.</mat-error>
    </mat-form-field>

    <!-- Heure de d√©part (requise) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Heure de d√©part</mat-label>
      <input matInput type="time"
            [(ngModel)]="data.data.heureDepart"
            required
            #time="ngModel"
            [disabled]="isReadOnly" />
      <mat-error *ngIf="time.invalid && time.touched">L'heure de d√©part est requise.</mat-error>
    </mat-form-field>
    <br/>
    <br/>
      <!-- Date de retour (requise) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Date de retour</mat-label>
      <input matInput [(ngModel)]="data.data.dateRetour"
            [matDatepicker]="pickerRetour"
            [disabled]="isReadOnly"
            required
            #retour="ngModel"
            readonly />
      <mat-datepicker-toggle matIconSuffix [for]="pickerRetour"></mat-datepicker-toggle>
      <mat-datepicker #pickerRetour></mat-datepicker>
      <mat-error *ngIf="retour.invalid && retour.touched">La date de retour est requise.</mat-error>
    </mat-form-field>

    <!-- Heure de retour (requise) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Heure de retour</mat-label>
      <input matInput type="time"
            [(ngModel)]="data.data.heureRetour"
            [disabled]="isReadOnly"
            required
            #timeRetour="ngModel" />
      <mat-error *ngIf="timeRetour.invalid && timeRetour.touched">L'heure de retour est requise.</mat-error>
    </mat-form-field>

  </div>

  <!-- √âtape 2 : S√©lection des membres de l'√©quipe -->
  <div *ngIf="currentStep === 2">
    <h3>D√©tail de la mission</h3>
    <br/>
    <br/>
    <div style="display: flex; justify-content: space-between; align-items: flex-start; width: 100%;">

      <!-- S√©lectionner les employ√©s pour l'√©quipe -->
      <div style="width: 60%; padding-right: 20px;">
        <mat-form-field appearance="outline" class="full-width" style="flex-grow: 1;">
          <mat-label>S√©lectionner les membres de l'√©quipe</mat-label>
          <mat-select [(ngModel)]="data.data.teamIds" multiple required #team="ngModel">
            <mat-option *ngFor="let emp of teams" [value]="emp.employeeId">
              {{ emp.firstName + " "+ emp.lastName }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="team.invalid && team.touched">Veuillez s√©lectionner des membres de l'√©quipe.</mat-error>
        </mat-form-field>
      </div>

      <!-- Afficher les employ√©s s√©lectionn√©s devant le champ -->
      <div *ngIf="data.data.teamIds && data.data.teamIds.length > 0" style="width: 35%; padding-left: 20px;">
        <p><strong>Employ√©s de l'√©quipe :</strong></p>
        <ul style="padding-left: 0; list-style: none;">
          <li *ngFor="let empId of data.data.teamIds">
            {{ getEmployeeNameById(empId) }}
          </li>
        </ul>
      </div>
    </div>
    <!-- S√©lectionner un v√©hicule pour la mission (uniquement un) -->
    <br/>
    <br/>
    <mat-form-field appearance="outline" class="full-width" style="flex-grow: 1;">
      <mat-label>S√©lectionner un v√©hicule</mat-label>
      <mat-select [(ngModel)]="data.data.vehiculeId" required #vehicle="ngModel">
        <mat-option *ngFor="let vehicule of vehicules" [value]="vehicule.vehiculeId">
          {{ vehicule.vehiculeName }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="vehicle.invalid && vehicle.touched">Veuillez s√©lectionner un v√©hicule.</mat-error>
    </mat-form-field>
  </div>

  <!-- √âtape 3 : R√©capitulatif -->
  <div *ngIf="currentStep === 3">
    <h3>R√©capitulatif</h3>
    <br/>
    <div style="display: flex; flex-direction: column; align-items: flex-start; width: 100%; padding-right: 20px;">
      <p><strong>Nom de la mission :</strong> {{ data.data.name }}</p>
      <p><strong>status de la mission :</strong> {{ data.data.statutId }}</p>
      <p><strong>Employ√© concern√© :</strong> {{ getEmployeeNameById(data.data.employeId) }}</p>
      <p><strong>Date de d√©but :</strong> {{ data.data.dateDebut | date: 'dd/MM/yyyy' }}</p>
      <p><strong>Date de fin :</strong> {{ data.data.dateFin | date: 'dd/MM/yyyy' }}</p>
      <p><strong>Description :</strong> {{ data.data.description || 'Aucune description fournie' }}</p>
      <p><strong>Employ√©s de l'√©quipe :</strong></p>
      <ul style="padding-left: 0; list-style: none;">
        <li *ngFor="let empId of data.data.teamIds">
          {{ getEmployeeNameById(empId) }}
        </li>
      </ul>
      <p><strong>V√©hicule s√©lectionn√© :</strong> {{ getVehiculeNameById(data.data.vehiculeId) }}</p>
    </div>
  </div>
  <!-- √âtape 4 : Message de succ√®s -->
  <div *ngIf="currentStep === 4">
    <h3 style="text-align: center; color: green;">üéâ Mission cr√©√©e avec succ√®s !</h3>
    <br/>
    <p style="text-align: center;">Vous pouvez maintenant imprimer les d√©tails ou consulter la liste des missions.</p>
    <div style="display: flex; justify-content: center; gap: 16px; margin-top: 20px;">
      <button mat-raised-button color="primary" (click)="printMission()">üñ®Ô∏è Imprimer</button>
      <button mat-button color="accent" (click)="redirectToConsultation()">üîç Consulter les missions</button>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button *ngIf="currentStep < 3 " (click)="onCancel()">Annuler</button>
  <button mat-button *ngIf="currentStep > 1 && currentStep < 4" (click)="previousStep()">Pr√©c√©dent</button>
  <button mat-button *ngIf="currentStep < 3 " [disabled]="!isStepValid()" (click)="nextStep()">Suivant</button>
  <button mat-raised-button color="accent" *ngIf="currentStep === 3" (click)="submitMission()">Valider et cr√©er la mission</button>
</mat-dialog-actions>
